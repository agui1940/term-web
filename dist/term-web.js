/*!
 * term-web.js v1.0.3
 * Github: https://github.com/zhw2590582/term-web#readme
 * (c) 2017-2020 Harvey Zack
 * Released under the MIT License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Term=e()}(this,function(){"use strict";var o=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var y=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};var i=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t};function t(t,e){return t(e={exports:{}},e.exports),e.exports}var r=t(function(e){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(t){return typeof t}:e.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}e.exports=r});var a=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e},c=t(function(e){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}e.exports=r}),u=t(function(r){function n(t,e){return r.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}r.exports=n});var e=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)},z=t(function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return t.constructor?t.constructor.name:null}function c(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return u(t,e,r),l(t,e,r),function(i,s,a){var t=f(s),e=f(i);if("object"===t){if("object"!==e)throw new Error("[Type Error]: '".concat(a.join("."),"' require 'object' type, but got '").concat(e,"'"));Object.keys(s).forEach(function(t){var e=i[t],r=s[t],n=a.slice();n.push(t),u(e,r,n),l(e,r,n),c(e,r,n)})}if("array"===t){if("array"!==e)throw new Error("[Type Error]: '".concat(a.join("."),"' require 'array' type, but got '").concat(e,"'"));i.forEach(function(t,e){var r=i[e],n=s[e]||s[0],o=a.slice();o.push(e),u(r,n,o),l(r,n,o),c(r,n,o)})}}(t,e,r),t}function u(t,e,r){if("string"===f(e)){var n=f(t);if(!(-1<e.indexOf("|")?e.split("|").map(function(t){return t.toLowerCase().trim()}).filter(Boolean).some(function(t){return n===t}):e.toLowerCase().trim()===n))throw new Error("[Type Error]: '".concat(r.join("."),"' require '").concat(e,"' type, but got '").concat(n,"'"))}}function l(t,e,r){if("function"===f(e)){var n=e(t,f(t),r);if(!0!==n){var o=f(n);throw"string"===o?new Error(n):"error"===o?n:new Error("[Validator Error]: The scheme for '".concat(r.join("."),"' validator require return true, but got '").concat(n,"'"))}}}var i,f;t.exports=(i=Object.prototype.toString,c.kindOf=f=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e,r=n(t);if("boolean"===r)return"boolean";if("string"===r)return"string";if("number"===r)return"number";if("symbol"===r)return"symbol";if("function"===r)return"GeneratorFunction"===o(t)?"generatorfunction":"function";if(e=t,Array.isArray?Array.isArray(e):e instanceof Array)return"array";if(t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))return"buffer";if(function(t){try{if("number"==typeof t.length&&"function"==typeof t.callee)return 1}catch(t){if(-1!==t.message.indexOf("callee"))return 1}}(t))return"arguments";if(t instanceof Date||"function"==typeof t.toDateString&&"function"==typeof t.getDate&&"function"==typeof t.setDate)return"date";if(t instanceof Error||"string"==typeof t.message&&t.constructor&&"number"==typeof t.constructor.stackTraceLimit)return"error";if(t instanceof RegExp||"string"==typeof t.flags&&"boolean"==typeof t.ignoreCase&&"boolean"==typeof t.multiline&&"boolean"==typeof t.global)return"regexp";switch(o(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof t.throw&&"function"==typeof t.return&&"function"==typeof t.next)return"generator";switch(r=i.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return r.slice(8,-1).toLowerCase().replace(/\s/g,"")},c)}),l=function(){function t(){y(this,t)}return s(t,[{key:"on",value:function(t,e,r){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:r}),this}},{key:"once",value:function(n,o,i){var s=this;function a(){s.off(n,a);for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];o.apply(i,e)}return a._=o,this.on(n,a,i)}},{key:"emit",value:function(t){for(var e=((this.e||(this.e={}))[t]||[]).slice(),r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var i=0;i<e.length;i+=1)e[i].fn.apply(e[i].ctx,n);return this}},{key:"off",value:function(t,e){var r=this.e||(this.e={}),n=r[t],o=[];if(n&&e)for(var i=0,s=n.length;i<s;i+=1)n[i].fn!==e&&n[i].fn._!==e&&o.push(n[i]);return o.length?r[t]=o:delete r[t],this}}]),t}(),f=function(){function p(r){y(this,p),this.destroyEvents=[],this.proxy=this.proxy.bind(this);var n=r.options.recorder,t=r.template,e=t.$recorder,o=t.$recorderSize,i=t.$recorderDuration,s=t.$recorderBtn,a=r.template,c=a.$textarea,u=a.$main,l=a.$scrollbar,f=a.$header,h=a.$footer;this.proxy(document,["click","contextmenu"],function(t){t.composedPath&&-1<t.composedPath().indexOf(u)?(r.isFocus=!0,r.emit("focus")):(r.isFocus=!1,r.emit("blur"))}),this.proxy(c,"input",function(){r.emit("input",c.value.trim())}),this.proxy(c,"paste",function(){r.emit("input",c.value.trim())}),this.proxy(c,"keydown",function(t){var e=t.keyCode;13===e&&setTimeout(function(){r.emit("enter",c.value.trim()),c.value=""}),[37,38,39,40].includes(e)&&(c.blur(),setTimeout(function(){return c.focus()})),r.emit("keydown",t)});var d=!1;this.proxy(u,"scroll",function(){d?r.drawer.renderByTop(u.scrollTop):d=!0}),this.proxy(s,"click",function(){r.recorder.recording?r.recorder.end():r.recorder.start()}),r.on("scroll",function(t){var e=t.scrollHeight,r=t.scrollTop;l.style.height="".concat(e,"px"),d=!1,u.scrollTo(0,r)}),r.on("cursor",function(t){var e=t.left,r=t.top;c.style.top="".concat(r,"px"),c.style.left="".concat(e,"px")}),r.on("size",function(t){var e=t.header,r=t.main,n=t.bottom;f.style.height="".concat(e,"px"),h.style.height="".concat(n,"px"),u.style.top="".concat(e,"px"),u.style.height="".concat(r,"px")}),r.on("focus",function(){c.focus()}),r.on("start",function(){n&&e.classList.add("recording")}),r.on("recording",function(t){var e=t.size,r=t.duration;n&&(o.innerText="".concat(Math.floor(e/1024)||0,"kb"),i.innerText="".concat(r||0,"s"))}),r.on("end",function(){n&&e.classList.remove("recording")})}return s(p,[{key:"proxy",value:function(e,t,r,n){var o=this,i=3<arguments.length&&void 0!==n?n:{};Array.isArray(t)?t.forEach(function(t){return o.proxy(e,t,r,i)}):(e.addEventListener(t,r,i),this.destroyEvents.push(function(){e.removeEventListener(t,r,i)}))}},{key:"destroy",value:function(){this.destroyEvents.forEach(function(t){return t()})}}]),p}();var h=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")};var d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}},p=t(function(n){function o(t,e,r){return d()?n.exports=o=Reflect.construct:n.exports=o=function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&u(o,r.prototype),o},o.apply(null,arguments)}n.exports=o});function m(n){return function(){var t,e=c(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return a(this,t)}}var g=function(t){e(n,t);var r=m(n);function n(t){var e;return y(this,n),(e=r.call(this,t)).name="TermError",e}return n}(t(function(e){function n(t){var r="function"==typeof Map?new Map:void 0;return e.exports=n=function(t){if(null===t||!h(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return p(t,arguments,c(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),u(e,t)},n(t)}e.exports=n})(Error));function b(t,e){if(!t)throw new g(e);return t}function v(t,e){var r=document.createElement("a");r.style.display="none",r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)}function F(t){return t.replace(/[&<>'"]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[t]||t})}var x=Object.freeze({__proto__:null,TermError:g,errorHandle:b,download:v,escape:F,unescape:function(t){return t.replace(/&amp;|&lt;|&gt;|&#39;|&quot;/g,function(t){return{"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&quot;":'"'}[t]||t})}}),w=function(){function d(t){var e=this;y(this,d);var r=(this.term=t).options,n=r.container,o=r.fontFamily,i=r.fontSize,s=r.fontColor,a=r.pixelRatio,c=r.width,u=r.height,l=r.borderRadius,f=r.boxShadow,h=r.recorder;this.$container=n,"string"==typeof t.options.container&&(this.$container=document.querySelector(t.options.container)),b(t.constructor.instances.every(function(t){return t.template.$container!==e.$container}),"Cannot mount multiple instances on the same dom element, please destroy the previous instance first."),this.$container.classList.add("term-container"),this.$container.style.width="".concat(c,"px"),this.$container.style.height="".concat(u,"px"),this.$canvas=document.createElement("canvas"),this.$canvas.classList.add("term-canvas"),this.$canvas.width=c*a,this.$canvas.height=u*a,this.$container.appendChild(this.$canvas),this.$header=document.createElement("div"),this.$header.classList.add("term-header"),this.$container.appendChild(this.$header),this.$main=document.createElement("div"),this.$main.classList.add("term-main"),this.$container.appendChild(this.$main),this.$scrollbar=document.createElement("div"),this.$scrollbar.classList.add("term-scrollbar"),this.$scrollbar.style.height="0",this.$main.appendChild(this.$scrollbar),this.$footer=document.createElement("div"),this.$footer.classList.add("term-footer"),this.$container.appendChild(this.$footer),this.$textarea=document.createElement("textarea"),this.$textarea.classList.add("term-textarea"),this.$container.appendChild(this.$textarea),h&&(this.$recorder=document.createElement("div"),this.$recorder.classList.add("term-recorder"),this.$recorder.innerHTML='<div class="term-recorder-size"></div><div class="term-recorder-duration"></div><div class="term-recorder-btn"></div> \n            ',this.$recorderSize=this.$recorder.querySelector(".term-recorder-size"),this.$recorderDuration=this.$recorder.querySelector(".term-recorder-duration"),this.$recorderBtn=this.$recorder.querySelector(".term-recorder-btn"),this.$header.appendChild(this.$recorder)),document.getElementById("term-ui-style")||(this.$style=document.createElement("style"),this.$style.id="term-ui-style",this.$style.textContent=[".term-container{font-family:".concat(o,";font-size:").concat(i,"px;color:").concat(s,";position:relative;}"),".term-container ::-webkit-scrollbar{width:5px;}",".term-container ::-webkit-scrollbar-thumb{background-color:#666;border-radius:5px;}",".term-container ::-webkit-scrollbar-thumb:hover{background-color:#ccc;}",".term-canvas{width:100%;height:100%;border-radius:".concat(l,"px;box-shadow:").concat(f,";}"),".term-textarea{position:absolute;width:20px;height:20px;opacity:0;pointer-events:none;user-select:none;}",".term-main{position:absolute;width:100%;right:0;left:0; overflow: auto;}",".term-main:hover{cursor:text}",".term-recorder{display:flex;align-items:center;position:absolute;right:10px;top:10px;}",".term-recorder-size, .term-recorder-duration{display:none;margin-right:10px;}",".term-recorder-btn{height:18px;width:18px;background:#F44336;border-radius:3px;cursor:pointer;}",".term-recorder.recording .term-recorder-btn{background:#FFC107;}",".term-recorder.recording .term-recorder-size{display:block;}",".term-recorder.recording .term-recorder-duration{display:block;}",".term-header{position:absolute;width:100%;top:0;left:0;right:0;}",".term-footer{position:absolute;width:100%;bottom:0;left:0;right:0;}"].join(""),document.head.appendChild(this.$style))}return s(d,[{key:"destroy",value:function(){this.$container.innerHTML="",this.term.constructor.instances.length||document.head.removeChild(this.$style)}}]),d}();var k=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n};var $=function(t){if(Array.isArray(t))return k(t)};var S=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)};var E=function(t,e){if(t){if("string"==typeof t)return k(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}};var O=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};function j(t,e){var s={bools:{},strings:{},unknownFn:null};"function"==typeof(e=e||{}).unknown&&(s.unknownFn=e.unknown),"boolean"==typeof e.boolean&&e.boolean?s.allBools=!0:[].concat(e.boolean).filter(Boolean).forEach(function(t){s.bools[t]=!0});var a={};Object.keys(e.alias||{}).forEach(function(t){a[t]=[].concat(e.alias[t]),a[t].forEach(function(e){a[e]=[t].concat(a[t].filter(function(t){return e!==t}))})}),[].concat(e.string).filter(Boolean).forEach(function(t){s.strings[t]=!0,a[t]&&(s.strings[a[t]]=!0)});var o=e.default||{},c={_:[]};Object.keys(s.bools).forEach(function(t){n(t,void 0!==o[t]&&o[t])});var r=[];function n(t,e,r){if(!r||!s.unknownFn||(n=t,o=r,s.allBools&&/^--[^=]+$/.test(o)||s.strings[n]||s.bools[n]||a[n])||!1!==s.unknownFn(r)){var n,o,i=!s.strings[t]&&R(e)?Number(e):e;u(c,t.split("."),i),(a[t]||[]).forEach(function(t){u(c,t.split("."),i)})}}function u(t,e,r){for(var n=t,o=0;o<e.length-1;o++){if("__proto__"===(i=e[o]))return;void 0===n[i]&&(n[i]={}),n[i]!==Object.prototype&&n[i]!==Number.prototype&&n[i]!==String.prototype||(n[i]={}),n[i]===Array.prototype&&(n[i]=[]),n=n[i]}var i;"__proto__"!==(i=e[e.length-1])&&(n!==Object.prototype&&n!==Number.prototype&&n!==String.prototype||(n={}),n===Array.prototype&&(n=[]),void 0===n[i]||s.bools[i]||"boolean"==typeof n[i]?n[i]=r:Array.isArray(n[i])?n[i].push(r):n[i]=[n[i],r])}function i(t){return a[t].some(function(t){return s.bools[t]})}-1!==t.indexOf("--")&&(r=t.slice(t.indexOf("--")+1),t=t.slice(0,t.indexOf("--")));for(var l=0;l<t.length;l++){var f=t[l];if(/^--.+=/.test(f)){var h=f.match(/^--([^=]+)=([\s\S]*)$/),d=h[1],p=h[2];s.bools[d]&&(p="false"!==p),n(d,p,f)}else if(/^--no-.+/.test(f)){n(d=f.match(/^--no-(.+)/)[1],!1,f)}else if(/^--.+/.test(f)){d=f.match(/^--(.+)/)[1];void 0===(b=t[l+1])||/^-/.test(b)||s.bools[d]||s.allBools||a[d]&&i(d)?/^(true|false)$/.test(b)?(n(d,"true"===b,f),l++):n(d,!s.strings[d]||"",f):(n(d,b,f),l++)}else if(/^-[^-]+/.test(f)){for(var y=f.slice(1,-1).split(""),m=!1,g=0;g<y.length;g++){var b;if("-"!==(b=f.slice(g+2))){if(/[A-Za-z]/.test(y[g])&&/=/.test(b)){n(y[g],b.split("=")[1],f),m=!0;break}if(/[A-Za-z]/.test(y[g])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(b)){n(y[g],b,f),m=!0;break}if(y[g+1]&&y[g+1].match(/\W/)){n(y[g],f.slice(g+2),f),m=!0;break}n(y[g],!s.strings[y[g]]||"",f)}else n(y[g],b,f)}d=f.slice(-1)[0];m||"-"===d||(!t[l+1]||/^(-|--)[^-]/.test(t[l+1])||s.bools[d]||a[d]&&i(d)?t[l+1]&&/^(true|false)$/.test(t[l+1])?(n(d,"true"===t[l+1],f),l++):n(d,!s.strings[d]||"",f):(n(d,t[l+1],f),l++))}else if(s.unknownFn&&!1===s.unknownFn(f)||c._.push(s.strings._||!R(f)?f:Number(f)),e.stopEarly){c._.push.apply(c._,t.slice(l+1));break}}return Object.keys(o).forEach(function(e){var t,r,n;t=c,r=e.split("."),n=t,r.slice(0,-1).forEach(function(t){n=n[t]||{}}),r[r.length-1]in n||(u(c,e.split("."),o[e]),(a[e]||[]).forEach(function(t){u(c,t.split("."),o[e])}))}),e["--"]?(c["--"]=new Array,r.forEach(function(t){c["--"].push(t)})):r.forEach(function(t){c._.push(t)}),c}var _=function(t){return $(t)||S(t)||E(t)||O()},P="input",D="output",C={videoBitsPerSecond:5e6,mimeType:"video/webm"},T=function(){function e(t){y(this,e),this.term=t,this.span=document.createElement("span")}return s(e,[{key:"decode",value:function(t){if(!t)return[];z(t,{type:function(t){return!![P,D].includes(t)||'The type must be "'.concat(P,'" or "').concat(D,'"')},text:"string",color:"undefined|string",replace:"undefined|boolean"});var e=this.term,r=e.drawer,n=r.ctx,o=r.width,i=r.padding,s=e.options,a=s.prefix,c=s.fontColor;t.type===P&&(t.text=a+F(t.text));for(var u=[],l=t.text.split(/\r?\n/),f=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,h=0,d=i[3],p=0;p<l.length;p+=1){var y=l[p];this.span.innerHTML=y.replace(f,"");for(var m=0;m<this.span.childNodes.length;m+=1){var g=this.span.childNodes[m],b=g.textContent,v=n.measureText(b).width,x=g.getAttribute&&g.getAttribute("color")||c,w=d+v;if(o<w){for(var k="",$=!1,S=d,E=_(b),O=0;O<E.length;O+=1){var j=E[O],C=n.measureText(j).width,T=d+C;if(T<o)k+=j,d=T;else{var L={width:n.measureText(k).width,left:$?i[3]:S,text:k,color:x};u[h]?u[h].push(L):u[h]=[L],h+=1,k=j,$=!0,d=i[3]+C}}var R={width:n.measureText(k).width,left:i[3],text:k,color:x};u[h]?u[h].push(R):u[h]=[R]}else{var A={width:v,text:b,left:d,color:x};u[h]?u[h].push(A):u[h]=[A],d=w}}h+=1,d=i[3]}return u}}]),e}(),L=function(){function u(t){y(this,u);var e=(this.term=t).options,r=e.pixelRatio,n=e.fontSize,o=e.fontFamily,i=e.backgroundColor;this.gap=10*r,this.fontSize=n*r,this.padding=[45,15,15,15].map(function(t){return t*r}),this.cursorColor=["#FFF",i],this.btnColor=["#FF5F56","#FFBD2E","#27C93F"],this.btnSize=6*r,this.$canvas=t.template.$canvas;var s=this.$canvas,a=s.width,c=s.height;this.height=c-this.padding[0]-this.padding[2],this.width=a-this.padding[1]-this.padding[3],this.totalLine=Math.floor(this.height/(this.fontSize+this.gap)),this.ctx=this.$canvas.getContext("2d"),this.ctx.font="".concat(this.fontSize,"px ").concat(o),this.ctx.textBaseline="top",this.inputs=[],this.logs=[],this.renderLogs=[],this.term.emit("size",{header:this.padding[0]/r,main:this.height/r,bottom:this.padding[2]/r}),this.draw(),this.draw=this.draw.bind(this),this.cursor=!1,function t(){var e=this;this.timer=setTimeout(function(){e.cursor=!e.cursor,e.drawCursor(),t.call(e)},500)}.call(this)}return s(u,[{key:"draw",value:function(t,e){return this.drawBackground(),this.drawTopbar(),this.drawContent(t,e),this}},{key:"drawBackground",value:function(){var t=this.term.options.backgroundColor,e=this.$canvas,r=e.width,n=e.height;this.ctx.clearRect(0,0,r,n),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,r,n)}},{key:"drawTopbar",value:function(){var r=this,t=this.term.options,e=t.title,n=t.fontColor;this.ctx.fillStyle=n;var o=this.ctx.measureText(e).width;this.ctx.fillText(e,this.$canvas.width/2-o/2,this.padding[1]-this.btnSize/2),this.btnColor.forEach(function(t,e){r.ctx.beginPath(),r.ctx.arc(r.padding[3]+r.btnSize+e*r.btnSize*3.6,r.padding[1]+r.btnSize,r.btnSize,0,360,!1),r.ctx.fillStyle=t,r.ctx.fill(),r.ctx.closePath()})}},{key:"drawContent",value:function(e,t){var r=this;if(e){if(e.replace){var n=this.inputs[this.inputs.length-1];n&&(this.logs=this.logs.filter(function(t){return t.input!==n}))}this.inputs.push(e),this.term.decoder.decode(e).forEach(function(t){t.input=e,r.logs.push(t)})}if("number"==typeof t){var o=this.logs.slice(t,t+this.totalLine);this.render(o)}else{var i=this.logs.slice(-this.totalLine);this.render(i)}}},{key:"renderByTop",value:function(t){var e=this.term.options.pixelRatio,r=Math.ceil(t*e/(this.fontSize+this.gap));this.draw(null,r)}},{key:"render",value:function(t){var e=this.term.options.pixelRatio;this.renderLogs=t;for(var r=0;r<t.length;r+=1){var n=t[r];if(n)for(var o=0;o<n.length;o+=1){var i=n[o];this.ctx.fillStyle=i.color;var s=this.padding[0]+(this.fontSize+this.gap)*r;this.ctx.fillText(i.text,i.left,s)}}var a=this.cursorPos,c=a.left,u=a.top;if(this.term.emit("cursor",{left:c/e,top:u/e}),this.logs[this.logs.length-1]===this.renderLogs[this.renderLogs.length-1]){this.scrollHeight=this.logs.length*(this.fontSize+this.gap)/e;var l=this.renderLogs[this.renderLogs.length-1],f=this.logs.indexOf(l);this.scrollTop=((f+1)*(this.fontSize+this.gap)-this.height)/e,this.term.emit("scroll",{scrollHeight:this.scrollHeight,scrollTop:this.scrollTop})}}},{key:"drawCursor",value:function(){var t=this.cursorPos,e=t.left,r=t.top,n=this.term.options.pixelRatio;this.renderEditable&&(this.ctx.fillStyle=this.cursor?this.cursorColor[0]:this.cursorColor[1],this.ctx.fillRect(e,r,5*n,this.fontSize))}},{key:"editable",get:function(){var t=this.logs[this.logs.length-1];return this.term.isFocus&&t&&t.length&&t.input.type===P}},{key:"renderEditable",get:function(){var t=this.logs[this.logs.length-1],e=this.renderLogs[this.renderLogs.length-1];return t===e&&this.term.isFocus&&e&&e.length&&e.input.type===P}},{key:"cursorPos",get:function(){if(this.renderEditable){var t=this.term.options.pixelRatio,e=this.renderLogs[this.renderLogs.length-1],r=e[e.length-1];return{left:r.left+r.width+4*t,top:this.padding[0]+(this.fontSize+this.gap)*(this.renderLogs.length-1)}}return{left:0,top:0}}}]),u}();function R(t){return"number"==typeof t||(/^0x[0-9a-f]+$/i.test(t)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(t))}var A=function(){function o(t){var e=this;y(this,o);var r=(this.term=t).drawer,n=t.options.welcome;this.input=this.input.bind(this),this.output=this.output.bind(this),this.clear=this.clear.bind(this),this.output(n).input(""),t.on("input",function(t){r.editable&&e.input(t,!0)}),t.on("enter",function(t){r.editable&&e.execute(t)})}return s(o,[{key:"execute",value:function(t){var n=this;if(!t.trim())return this.input("");var e=this.term.options,r=e.parseOpt,o=e.notFound,i=e.loading,s=this.findAction(t),a=j(t.split(" "),r);if(!s){var c=o.call(this.term,t,a);return this.output(c).input("")}if("function"!=typeof s.output)return this.output(s.output).input("");try{var u=s.output.call(this.term,t,a);if("promise"!==z.kindOf(u))return void 0===u?this.input(""):this.output(u).input("");var l=i.call(this.term,t,a);return this.output(l),u.then(function(t){return void 0===t?n.input(""):n.output(t,!0).input("")}).catch(function(t){var e="error"===z.kindOf(t)?"".concat(String(t)):"Error: ".concat(String(t)),r='<d color="red">'.concat(e,"</d>");return n.output(r,!0).input("")})}catch(t){var f='<d color="red">'.concat(String(t),"</d>");return this.output(f).input("")}}},{key:"findAction",value:function(r){return r=r.trim().toLowerCase(),this.term.options.actions.find(function(t){var e=z.kindOf(t.input);return"string"===e?r===t.input:"regexp"===e?t.input.test(r):null})}},{key:"output",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return this.term.drawer.draw({type:D,replace:r,text:String(t)}),this}},{key:"input",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return this.term.drawer.draw({type:P,replace:r,text:String(t)}),this}},{key:"clear",value:function(){return this.term.drawer.logs=[],this.term.drawer.draw(),this}}]),o}(),B=function(){function e(t){y(this,e),this.term=t,this.blobs=[]}return s(e,[{key:"start",value:function(){var e=this;b(!this.recording,"The recorder is recording...");var t=this.term.template.$canvas;this.stream=t.captureStream(30),b(this.stream,"Cannot get MediaStream of canvas"),b(MediaRecorder&&MediaRecorder.isTypeSupported(C.mimeType),"Does not support recording webm video"),this.recorder=new MediaRecorder(this.stream,C),this.recorder.ondataavailable=function(t){e.recording&&t.data&&0<t.data.size&&(e.blobs.push(t.data),e.term.emit("recording",{size:e.size,duration:e.duration}))},this.recorder.onstart=function(){e.term.emit("start")},this.recorder.start(1e3)}},{key:"end",value:function(){this.recorder.stop();var t=URL.createObjectURL(new Blob(this.blobs));v(t,"".concat(Date.now(),".webm")),URL.revokeObjectURL(t),this.blobs=[],this.term.emit("end")}},{key:"recording",get:function(){return this.recorder&&"recording"===this.recorder.state}},{key:"size",get:function(){return this.blobs.reduce(function(t,e){return t+e.size},0)}},{key:"duration",get:function(){return this.blobs.length}}]),e}();function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function q(n){return function(){var t,e=c(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return a(this,t)}}var I=0,U=[];return function(){e(n,l);var r=q(n);function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return y(this,n),(t=r.call(this)).options=z(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach(function(t){o(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},n.default,{},e),n.scheme),t.isFocus=!1,t.template=new w(i(t)),t.events=new f(i(t)),t.decoder=new T(i(t)),t.drawer=new L(i(t)),t.commander=new A(i(t)),t.recorder=new B(i(t)),t.input=t.commander.input,t.output=t.commander.output,t.clear=t.commander.clear,t.start=t.recorder.start,t.end=t.recorder.end,I+=1,t.id=I,U.push(i(t)),t}return s(n,null,[{key:"instances",get:function(){return U}},{key:"version",get:function(){return"1.0.3"}},{key:"utils",get:function(){return x}},{key:"default",get:function(){return{container:"#term",width:600,height:500,actions:[],parseOpt:{},recorder:!0,borderRadius:5,fontSize:13,fontFamily:"Arial",fontColor:"#b0b2b6",title:"Term Web",prefix:'root@linux: ~ <d color="#00f501">$</d> ',welcome:"Last login: ".concat(new Date),loading:function(){return'<d color="yellow">Loading...</d>'},boxShadow:"rgba(0, 0, 0, 0.55) 0px 20px 68px",backgroundColor:"rgb(42, 39, 52)",pixelRatio:window.devicePixelRatio,notFound:function(t){return"-bash: <d color='red'>".concat(t,"</d>: command not found")}}}},{key:"scheme",get:function(){return{container:"string|htmldivelement",width:"number",height:"number",actions:[{input:"string|regexp",output:"string|function"}],parseOpt:"object",recorder:"boolean",borderRadius:"number",fontSize:"number",fontFamily:"string",fontColor:"string",title:"string",prefix:"string",welcome:"string",loading:"function",boxShadow:"string",backgroundColor:"string",pixelRatio:"number",notFound:"function"}}}]),s(n,[{key:"destroy",value:function(){U.splice(U.indexOf(this),1),this.events.destroy(),this.template.destroy(),this.emit("destroy")}}]),n}()});
