/*!
 * term-web.js v1.0.1
 * Github: https://github.com/zhw2590582/term-web#readme
 * (c) 2017-2020 Harvey Zack
 * Released under the MIT License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Term=e()}(this,function(){"use strict";var o=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var d=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};var i=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t};function t(t,e){return t(e={exports:{}},e.exports),e.exports}var r=t(function(e){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(t){return typeof t}:e.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}e.exports=r});var c=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e},a=t(function(e){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}e.exports=r}),u=t(function(r){function n(t,e){return r.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}r.exports=n});var e=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)},F=t(function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return t.constructor?t.constructor.name:null}function a(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return u(t,e,r),l(t,e,r),function(i,s,c){var t=f(s),e=f(i);if("object"===t){if("object"!==e)throw new Error("[Type Error]: '".concat(c.join("."),"' require 'object' type, but got '").concat(e,"'"));Object.keys(s).forEach(function(t){var e=i[t],r=s[t],n=c.slice();n.push(t),u(e,r,n),l(e,r,n),a(e,r,n)})}if("array"===t){if("array"!==e)throw new Error("[Type Error]: '".concat(c.join("."),"' require 'array' type, but got '").concat(e,"'"));i.forEach(function(t,e){var r=i[e],n=s[e]||s[0],o=c.slice();o.push(e),u(r,n,o),l(r,n,o),a(r,n,o)})}}(t,e,r),t}function u(t,e,r){if("string"===f(e)){var n=f(t);if(!(-1<e.indexOf("|")?e.split("|").map(function(t){return t.toLowerCase().trim()}).filter(Boolean).some(function(t){return n===t}):e.toLowerCase().trim()===n))throw new Error("[Type Error]: '".concat(r.join("."),"' require '").concat(e,"' type, but got '").concat(n,"'"))}}function l(t,e,r){if("function"===f(e)){var n=e(t,f(t),r);if(!0!==n){var o=f(n);throw"string"===o?new Error(n):"error"===o?n:new Error("[Validator Error]: The scheme for '".concat(r.join("."),"' validator require return true, but got '").concat(n,"'"))}}}var i,f;t.exports=(i=Object.prototype.toString,a.kindOf=f=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e,r=n(t);if("boolean"===r)return"boolean";if("string"===r)return"string";if("number"===r)return"number";if("symbol"===r)return"symbol";if("function"===r)return"GeneratorFunction"===o(t)?"generatorfunction":"function";if(e=t,Array.isArray?Array.isArray(e):e instanceof Array)return"array";if(t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))return"buffer";if(function(t){try{if("number"==typeof t.length&&"function"==typeof t.callee)return 1}catch(t){if(-1!==t.message.indexOf("callee"))return 1}}(t))return"arguments";if(t instanceof Date||"function"==typeof t.toDateString&&"function"==typeof t.getDate&&"function"==typeof t.setDate)return"date";if(t instanceof Error||"string"==typeof t.message&&t.constructor&&"number"==typeof t.constructor.stackTraceLimit)return"error";if(t instanceof RegExp||"string"==typeof t.flags&&"boolean"==typeof t.ignoreCase&&"boolean"==typeof t.multiline&&"boolean"==typeof t.global)return"regexp";switch(o(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof t.throw&&"function"==typeof t.return&&"function"==typeof t.next)return"generator";switch(r=i.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return r.slice(8,-1).toLowerCase().replace(/\s/g,"")},a)}),l=function(){function t(){d(this,t)}return s(t,[{key:"on",value:function(t,e,r){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:r}),this}},{key:"once",value:function(n,o,i){var s=this;function c(){s.off(n,c);for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];o.apply(i,e)}return c._=o,this.on(n,c,i)}},{key:"emit",value:function(t){for(var e=((this.e||(this.e={}))[t]||[]).slice(),r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var i=0;i<e.length;i+=1)e[i].fn.apply(e[i].ctx,n);return this}},{key:"off",value:function(t,e){var r=this.e||(this.e={}),n=r[t],o=[];if(n&&e)for(var i=0,s=n.length;i<s;i+=1)n[i].fn!==e&&n[i].fn._!==e&&o.push(n[i]);return o.length?r[t]=o:delete r[t],this}}]),t}(),f=function(){function p(r){d(this,p),this.destroyEvents=[],this.proxy=this.proxy.bind(this);var n=r.options.recorder,t=r.template,e=t.$recorder,o=t.$recorderSize,i=t.$recorderDuration,s=t.$recorderBtn,c=r.template,a=c.$container,u=c.$textarea,l=c.$main,f=c.$scrollbar;this.proxy(document,["click","contextmenu"],function(t){t.composedPath&&-1<t.composedPath().indexOf(a)?(r.isFocus=!0,r.emit("focus")):(r.isFocus=!1,r.emit("blur"))}),this.proxy(u,"input",function(){r.emit("input",u.value.trim())}),this.proxy(u,"paste",function(){r.emit("input",u.value.trim())}),this.proxy(u,"keydown",function(t){var e=t.keyCode;13===e&&setTimeout(function(){r.emit("enter",u.value.trim()),u.value=""}),[37,38,39,40].includes(e)&&(u.blur(),setTimeout(function(){return u.focus()})),r.emit("keydown",t)});var h=!1;this.proxy(l,"scroll",function(){h?r.drawer.renderByTop(l.scrollTop):h=!0}),this.proxy(s,"click",function(){r.recorder.recording?r.recorder.end():r.recorder.start()}),r.on("scroll",function(t){var e=t.scrollHeight,r=t.scrollTop;f.style.height="".concat(e,"px"),h=!1,l.scrollTo(0,r)}),r.on("cursor",function(t){var e=t.left,r=t.top;u.style.top="".concat(r,"px"),u.style.left="".concat(e,"px")}),r.on("size",function(t){var e=t.top,r=t.height;l.style.top="".concat(e,"px"),l.style.height="".concat(r,"px")}),r.on("focus",function(){u.focus()}),r.on("start",function(){n&&e.classList.add("recording")}),r.on("recording",function(t){var e=t.size,r=t.duration;n&&(o.innerText="".concat(Math.floor(e/1024)||0,"kb"),i.innerText="".concat(r||0,"s"))}),r.on("end",function(){n&&e.classList.remove("recording")})}return s(p,[{key:"proxy",value:function(e,t,r,n){var o=this,i=3<arguments.length&&void 0!==n?n:{};Array.isArray(t)?t.forEach(function(t){return o.proxy(e,t,r,i)}):(e.addEventListener(t,r,i),this.destroyEvents.push(function(){e.removeEventListener(t,r,i)}))}},{key:"destroy",value:function(){this.destroyEvents.forEach(function(t){return t()})}}]),p}();var h=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")};var p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}},y=t(function(n){function o(t,e,r){return p()?n.exports=o=Reflect.construct:n.exports=o=function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&u(o,r.prototype),o},o.apply(null,arguments)}n.exports=o});function m(n){return function(){var t,e=a(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=a(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)}}var g=function(t){e(n,t);var r=m(n);function n(t){var e;return d(this,n),(e=r.call(this,t)).name="TermError",e}return n}(t(function(e){function n(t){var r="function"==typeof Map?new Map:void 0;return e.exports=n=function(t){if(null===t||!h(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return y(t,arguments,a(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),u(e,t)},n(t)}e.exports=n})(Error));function b(t,e){if(!t)throw new g(e);return t}var v=function(){function p(t){var e=this;d(this,p);var r=(this.term=t).options,n=r.container,o=r.fontFamily,i=r.fontSize,s=r.fontColor,c=r.pixelRatio,a=r.width,u=r.height,l=r.borderRadius,f=r.boxShadow,h=r.recorder;this.$container=n,"string"==typeof t.options.container&&(this.$container=document.querySelector(t.options.container)),b(t.constructor.instances.every(function(t){return t.template.$container!==e.$container}),"Cannot mount multiple instances on the same dom element, please destroy the previous instance first."),this.$container.classList.add("term-container"),this.$container.style.width="".concat(a,"px"),this.$container.style.height="".concat(u,"px"),this.$canvas=document.createElement("canvas"),this.$canvas.classList.add("term-canvas"),this.$canvas.width=a*c,this.$canvas.height=u*c,this.$container.appendChild(this.$canvas),this.$textarea=document.createElement("textarea"),this.$textarea.classList.add("term-textarea"),this.$container.appendChild(this.$textarea),this.$main=document.createElement("div"),this.$main.classList.add("term-main"),this.$container.appendChild(this.$main),this.$scrollbar=document.createElement("div"),this.$scrollbar.classList.add("term-scrollbar"),this.$scrollbar.style.height="0",this.$main.appendChild(this.$scrollbar),h&&(this.$recorder=document.createElement("div"),this.$recorder.classList.add("term-recorder"),this.$recorder.innerHTML='<div class="term-recorder-size"></div><div class="term-recorder-duration"></div><div class="term-recorder-btn"></div> \n            ',this.$recorderSize=this.$recorder.querySelector(".term-recorder-size"),this.$recorderDuration=this.$recorder.querySelector(".term-recorder-duration"),this.$recorderBtn=this.$recorder.querySelector(".term-recorder-btn"),this.$container.appendChild(this.$recorder)),document.getElementById("term-ui-style")||(this.$style=document.createElement("style"),this.$style.id="term-ui-style",this.$style.textContent=[".term-container{font-family:".concat(o,";font-size:").concat(i,"px;color:").concat(s,";position:relative;}"),".term-container ::-webkit-scrollbar{width:5px;}",".term-container ::-webkit-scrollbar-thumb{background-color:#666;border-radius:5px;}",".term-container ::-webkit-scrollbar-thumb:hover{background-color:#ccc;}",".term-canvas{width:100%;height:100%;border-radius:".concat(l,"px;box-shadow:").concat(f,";}"),".term-textarea{position:absolute;width:20px;height:20px;opacity:0;pointer-events:none;user-select:none;}",".term-main{position:absolute;width:100%;right:0;left:0; overflow: auto;}",".term-main:hover{cursor:text}",".term-recorder{display:flex;align-items:center;position:absolute;right:10px;top:10px;}",".term-recorder-size, .term-recorder-duration{display:none;margin-right:10px;}",".term-recorder-btn{height:18px;width:18px;background:#F44336;border-radius:3px;cursor:pointer;}",".term-recorder.recording .term-recorder-btn{background:#FFC107;}",".term-recorder.recording .term-recorder-size{display:block;}",".term-recorder.recording .term-recorder-duration{display:block;}"].join(""),document.head.appendChild(this.$style))}return s(p,[{key:"destroy",value:function(){this.$container.innerHTML="",this.term.constructor.instances.length||document.head.removeChild(this.$style)}}]),p}();var x=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n};var w=function(t){if(Array.isArray(t))return x(t)};var k=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)};var S=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}};var $=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};function O(t,e){var s={bools:{},strings:{},unknownFn:null};"function"==typeof(e=e||{}).unknown&&(s.unknownFn=e.unknown),"boolean"==typeof e.boolean&&e.boolean?s.allBools=!0:[].concat(e.boolean).filter(Boolean).forEach(function(t){s.bools[t]=!0});var c={};Object.keys(e.alias||{}).forEach(function(t){c[t]=[].concat(e.alias[t]),c[t].forEach(function(e){c[e]=[t].concat(c[t].filter(function(t){return e!==t}))})}),[].concat(e.string).filter(Boolean).forEach(function(t){s.strings[t]=!0,c[t]&&(s.strings[c[t]]=!0)});var o=e.default||{},a={_:[]};Object.keys(s.bools).forEach(function(t){n(t,void 0!==o[t]&&o[t])});var r=[];function n(t,e,r){if(!r||!s.unknownFn||(n=t,o=r,s.allBools&&/^--[^=]+$/.test(o)||s.strings[n]||s.bools[n]||c[n])||!1!==s.unknownFn(r)){var n,o,i=!s.strings[t]&&T(e)?Number(e):e;u(a,t.split("."),i),(c[t]||[]).forEach(function(t){u(a,t.split("."),i)})}}function u(t,e,r){for(var n=t,o=0;o<e.length-1;o++){if("__proto__"===(i=e[o]))return;void 0===n[i]&&(n[i]={}),n[i]!==Object.prototype&&n[i]!==Number.prototype&&n[i]!==String.prototype||(n[i]={}),n[i]===Array.prototype&&(n[i]=[]),n=n[i]}var i;"__proto__"!==(i=e[e.length-1])&&(n!==Object.prototype&&n!==Number.prototype&&n!==String.prototype||(n={}),n===Array.prototype&&(n=[]),void 0===n[i]||s.bools[i]||"boolean"==typeof n[i]?n[i]=r:Array.isArray(n[i])?n[i].push(r):n[i]=[n[i],r])}function i(t){return c[t].some(function(t){return s.bools[t]})}-1!==t.indexOf("--")&&(r=t.slice(t.indexOf("--")+1),t=t.slice(0,t.indexOf("--")));for(var l=0;l<t.length;l++){var f=t[l];if(/^--.+=/.test(f)){var h=f.match(/^--([^=]+)=([\s\S]*)$/),p=h[1],d=h[2];s.bools[p]&&(d="false"!==d),n(p,d,f)}else if(/^--no-.+/.test(f)){n(p=f.match(/^--no-(.+)/)[1],!1,f)}else if(/^--.+/.test(f)){p=f.match(/^--(.+)/)[1];void 0===(b=t[l+1])||/^-/.test(b)||s.bools[p]||s.allBools||c[p]&&i(p)?/^(true|false)$/.test(b)?(n(p,"true"===b,f),l++):n(p,!s.strings[p]||"",f):(n(p,b,f),l++)}else if(/^-[^-]+/.test(f)){for(var y=f.slice(1,-1).split(""),m=!1,g=0;g<y.length;g++){var b;if("-"!==(b=f.slice(g+2))){if(/[A-Za-z]/.test(y[g])&&/=/.test(b)){n(y[g],b.split("=")[1],f),m=!0;break}if(/[A-Za-z]/.test(y[g])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(b)){n(y[g],b,f),m=!0;break}if(y[g+1]&&y[g+1].match(/\W/)){n(y[g],f.slice(g+2),f),m=!0;break}n(y[g],!s.strings[y[g]]||"",f)}else n(y[g],b,f)}p=f.slice(-1)[0];m||"-"===p||(!t[l+1]||/^(-|--)[^-]/.test(t[l+1])||s.bools[p]||c[p]&&i(p)?t[l+1]&&/^(true|false)$/.test(t[l+1])?(n(p,"true"===t[l+1],f),l++):n(p,!s.strings[p]||"",f):(n(p,t[l+1],f),l++))}else if(s.unknownFn&&!1===s.unknownFn(f)||a._.push(s.strings._||!T(f)?f:Number(f)),e.stopEarly){a._.push.apply(a._,t.slice(l+1));break}}return Object.keys(o).forEach(function(e){var t,r,n;t=a,r=e.split("."),n=t,r.slice(0,-1).forEach(function(t){n=n[t]||{}}),r[r.length-1]in n||(u(a,e.split("."),o[e]),(c[e]||[]).forEach(function(t){u(a,t.split("."),o[e])}))}),e["--"]?(a["--"]=new Array,r.forEach(function(t){a["--"].push(t)})):r.forEach(function(t){a._.push(t)}),a}var P=function(t){return w(t)||k(t)||S(t)||$()},_="input",D="output",E={videoBitsPerSecond:5e6,mimeType:"video/webm"},j=function(){function e(t){d(this,e),this.term=t}return s(e,[{key:"decode",value:function(t){if(!t)return[];F(t,{type:function(t){return!![_,D].includes(t)||'The type must be "'.concat(_,'" or "').concat(D,'"')},text:"string",color:"undefined|string",replace:"undefined|boolean"});var e=this.term,r=e.drawer,n=r.ctx,o=r.width,i=r.padding,s=e.options,c=s.prefix,a=s.fontColor;t.type===_&&(t.text=c+t.text);for(var u=[],l=t.text.split(/\r?\n/),f=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,h=0,p=i[3],d=0;d<l.length;d+=1){var y=l[d],m=document.createElement("span");m.innerHTML=y.replace(f,"");for(var g=0;g<m.childNodes.length;g+=1){var b=m.childNodes[g],v=b.textContent,x=n.measureText(v).width,w=b.getAttribute&&b.getAttribute("color")||a,k=p+x;if(o<k){for(var S="",$=!1,O=p,E=P(v),j=0;j<E.length;j+=1){var C=E[j],T=n.measureText(C).width,R=p+T;if(R<o)S+=C,p=R;else{var A={width:n.measureText(S).width,left:$?i[3]:O,text:S,color:w};u[h]?u[h].push(A):u[h]=[A],h+=1,S=C,$=!0,p=i[3]+T}}var L={width:n.measureText(S).width,left:i[3],text:S,color:w};u[h]?u[h].push(L):u[h]=[L]}else{var z={width:x,text:v,left:p,color:w};u[h]?u[h].push(z):u[h]=[z],p=k}}h+=1,p=i[3]}return u}}]),e}(),C=function(){function u(t){d(this,u);var e=(this.term=t).options,r=e.pixelRatio,n=e.fontSize,o=e.fontFamily,i=e.backgroundColor;this.gap=10*r,this.fontSize=n*r,this.padding=[45,15,15,15].map(function(t){return t*r}),this.cursorColor=["#FFF",i],this.btnColor=["#FF5F56","#FFBD2E","#27C93F"],this.btnSize=6*r,this.$canvas=t.template.$canvas;var s=this.$canvas,c=s.width,a=s.height;this.height=a-this.padding[0]-this.padding[2],this.width=c-this.padding[1]-this.padding[3],this.totalLine=Math.floor(this.height/(this.fontSize+this.gap)),this.ctx=this.$canvas.getContext("2d"),this.ctx.font="".concat(this.fontSize,"px ").concat(o),this.ctx.textBaseline="top",this.inputs=[],this.logs=[],this.renderLogs=[],this.draw(),this.draw=this.draw.bind(this),this.cursor=!1,function t(){var e=this;this.timer=setTimeout(function(){e.cursor=!e.cursor,e.drawCursor(),t.call(e)},500)}.call(this)}return s(u,[{key:"draw",value:function(t,e){return this.drawBackground(),this.drawTopbar(),this.drawContent(t,e),this}},{key:"drawBackground",value:function(){var t=this.term.options.backgroundColor,e=this.$canvas,r=e.width,n=e.height;this.ctx.clearRect(0,0,r,n),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,r,n)}},{key:"drawTopbar",value:function(){var r=this,t=this.term.options,e=t.title,n=t.fontColor;this.ctx.fillStyle=n;var o=this.ctx.measureText(e).width;this.ctx.fillText(e,this.$canvas.width/2-o/2,this.padding[1]-this.btnSize/2),this.btnColor.forEach(function(t,e){r.ctx.beginPath(),r.ctx.arc(r.padding[3]+r.btnSize+e*r.btnSize*3.6,r.padding[1]+r.btnSize,r.btnSize,0,360,!1),r.ctx.fillStyle=t,r.ctx.fill(),r.ctx.closePath()})}},{key:"drawContent",value:function(e,t){var r=this;if(e){if(e.replace){var n=this.inputs[this.inputs.length-1];n&&(this.logs=this.logs.filter(function(t){return t.input!==n}))}this.inputs.push(e),this.term.decoder.decode(e).forEach(function(t){t.input=e,r.logs.push(t)})}if("number"==typeof t){var o=this.logs.slice(t,t+this.totalLine);this.render(o)}else{var i=this.logs.slice(-this.totalLine);this.render(i)}}},{key:"renderByTop",value:function(t){var e=this.term.options.pixelRatio,r=Math.ceil(t*e/(this.fontSize+this.gap));this.draw(null,r)}},{key:"render",value:function(t){var e=this.term.options.pixelRatio;this.renderLogs=t;for(var r=0;r<t.length;r+=1){var n=t[r];if(n)for(var o=0;o<n.length;o+=1){var i=n[o];this.ctx.fillStyle=i.color;var s=this.padding[0]+(this.fontSize+this.gap)*r;this.ctx.fillText(i.text,i.left,s)}}var c=this.cursorPos,a=c.left,u=c.top;if(this.term.emit("cursor",{left:a/e,top:u/e}),this.term.emit("size",{top:this.padding[0]/e,height:this.height/e}),this.logs[this.logs.length-1]===this.renderLogs[this.renderLogs.length-1]){this.scrollHeight=this.logs.length*(this.fontSize+this.gap)/e;var l=this.renderLogs[this.renderLogs.length-1],f=this.logs.indexOf(l);this.scrollTop=((f+1)*(this.fontSize+this.gap)-this.height)/e,this.term.emit("scroll",{scrollHeight:this.scrollHeight,scrollTop:this.scrollTop})}}},{key:"drawCursor",value:function(){var t=this.cursorPos,e=t.left,r=t.top,n=this.term.options.pixelRatio;this.renderEditable&&(this.ctx.fillStyle=this.cursor?this.cursorColor[0]:this.cursorColor[1],this.ctx.fillRect(e,r,5*n,this.fontSize))}},{key:"editable",get:function(){var t=this.logs[this.logs.length-1];return this.term.isFocus&&t&&t.length&&t.input.type===_}},{key:"renderEditable",get:function(){var t=this.logs[this.logs.length-1],e=this.renderLogs[this.renderLogs.length-1];return t===e&&this.term.isFocus&&e&&e.length&&e.input.type===_}},{key:"cursorPos",get:function(){if(this.renderEditable){var t=this.term.options.pixelRatio,e=this.renderLogs[this.renderLogs.length-1],r=e[e.length-1];return{left:r.left+r.width+4*t,top:this.padding[0]+(this.fontSize+this.gap)*(this.renderLogs.length-1)}}return{left:0,top:0}}}]),u}();function T(t){return"number"==typeof t||(/^0x[0-9a-f]+$/i.test(t)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(t))}var R=function(){function o(t){var e=this;d(this,o);var r=(this.term=t).drawer,n=t.options.welcome;this.output(n).input(""),t.on("input",function(t){r.editable&&e.input(t,!0)}),t.on("enter",function(t){r.editable&&e.execute(t)})}return s(o,[{key:"execute",value:function(t){var n=this;if(!t.trim())return this.input("");var e=this.term.options,r=e.parseOpt,o=e.notFound,i=e.loading,s=this.findAction(t),c=O(t.split(" "),r);if(!s){var a=o.call(this.term,t,c);return this.output(a).input("")}if("function"!=typeof s.output)return this.output(s.output).input("");try{var u=s.output.call(this.term,t,c);return"promise"===F.kindOf(u)?(this.output(i),u.then(function(t){return n.output(t,!0).input("")}).catch(function(t){var e="error"===F.kindOf(t)?"".concat(String(t)):"Error: ".concat(String(t)),r='<d color="red">'.concat(e,"</d>");return n.output(r,!0).input("")})):this.output(u).input("")}catch(t){var l='<d color="red">'.concat(String(t),"</d>");return this.output(l).input("")}}},{key:"findAction",value:function(r){return r=r.trim().toLowerCase(),this.term.options.actions.find(function(t){var e=F.kindOf(t.input);return"string"===e?r===t.input:"regexp"===e?t.input.test(r):null})}},{key:"output",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return this.term.drawer.draw({type:D,replace:r,text:String(t)}),this}},{key:"input",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return this.term.drawer.draw({type:_,replace:r,text:String(t)}),this}}]),o}(),A=function(){function e(t){d(this,e),this.term=t,this.blobs=[]}return s(e,[{key:"start",value:function(){var e=this;b(!this.recording,"The recorder is recording...");var t=this.term.template.$canvas;this.stream=t.captureStream(30),b(this.stream,"Cannot get MediaStream of canvas"),b(MediaRecorder&&MediaRecorder.isTypeSupported(E.mimeType),"Does not support recording webm video"),this.recorder=new MediaRecorder(this.stream,E),this.recorder.ondataavailable=function(t){e.recording&&t.data&&0<t.data.size&&(e.blobs.push(t.data),e.term.emit("recording",{size:e.size,duration:e.duration}))},this.recorder.onstart=function(){e.term.emit("start")},this.recorder.start(1e3)}},{key:"end",value:function(){this.recorder.stop();var t,e,r,n=URL.createObjectURL(new Blob(this.blobs));t=n,e="".concat(Date.now(),".webm"),(r=document.createElement("a")).style.display="none",r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),this.blobs=[],this.term.emit("end")}},{key:"recording",get:function(){return this.recorder&&"recording"===this.recorder.state}},{key:"size",get:function(){return this.blobs.reduce(function(t,e){return t+e.size},0)}},{key:"duration",get:function(){return this.blobs.length}}]),e}();function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function z(n){return function(){var t,e=a(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return;if(Reflect.construct.sham)return;if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}()){var r=a(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)}}var B=0,M=[];return function(){e(n,l);var r=z(n);function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return d(this,n),(t=r.call(this)).options=F(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach(function(t){o(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},n.default,{},e),n.scheme),t.isFocus=!1,t.template=new v(i(t)),t.events=new f(i(t)),t.decoder=new j(i(t)),t.drawer=new C(i(t)),t.commander=new R(i(t)),t.recorder=new A(i(t)),t.input=t.commander.input,t.output=t.commander.output,t.start=t.recorder.start,t.end=t.recorder.end,B+=1,t.id=B,M.push(i(t)),t}return s(n,null,[{key:"instances",get:function(){return M}},{key:"version",get:function(){return"1.0.1"}},{key:"default",get:function(){return{container:"#term",width:600,height:500,actions:[],parseOpt:{},recorder:!0,borderRadius:5,fontSize:13,fontFamily:"Arial",fontColor:"#b0b2b6",title:"Term Web",prefix:'root@linux: ~ <d color="#00f501">$</d> ',welcome:"Last login: ".concat(new Date),loading:'<d color="yellow">Loading...</d>',boxShadow:"rgba(0, 0, 0, 0.55) 0px 20px 68px",backgroundColor:"rgb(42, 39, 52)",pixelRatio:window.devicePixelRatio,notFound:function(t){return"-bash: <d color='red'>".concat(t,"</d>: command not found")}}}},{key:"scheme",get:function(){return{container:"string|htmldivelement",width:"number",height:"number",actions:[{input:"string|regexp",output:"string|function"}],parseOpt:"object",recorder:"boolean",borderRadius:"number",fontSize:"number",fontFamily:"string",fontColor:"string",title:"string",prefix:"string",welcome:"string",loading:"string",boxShadow:"string",backgroundColor:"string",pixelRatio:"number",notFound:"function"}}}]),s(n,[{key:"destroy",value:function(){M.splice(M.indexOf(this),1),this.events.destroy(),this.template.destroy(),this.emit("destroy")}}]),n}()});
